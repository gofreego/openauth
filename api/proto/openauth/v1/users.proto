syntax = "proto3";
package v1;

option go_package = "./openauth_v1";

// User represents a user account in the system
message User {
    int64 id = 1;
    string uuid = 2;
    string username = 3;
    optional string email = 4;
    optional string phone = 5;
    bool email_verified = 6;
    bool phone_verified = 7;
    bool is_active = 8;
    bool is_locked = 9;
    int32 failed_login_attempts = 10;
    optional int64 last_login_at = 11;
    int64 password_changed_at = 12;
    int64 created_at = 13;
    int64 updated_at = 14;
}

// UserProfile represents extended user profile information
message UserProfile {
    int64 id = 1;
    string uuid = 2;
    int64 user_id = 3;
    optional string profile_name = 4;  // Name/label for this profile
    optional string first_name = 5;
    optional string last_name = 6;
    optional string display_name = 7;
    optional string bio = 8;
    optional string avatar_url = 9;
    optional int64 date_of_birth = 10;  // Unix timestamp
    optional string gender = 11;
    optional string timezone = 12;
    optional string locale = 13;
    optional string country = 14;
    optional string city = 15;
    optional string address = 16;
    optional string postal_code = 17;
    optional string website_url = 18;
    bytes metadata = 19;  // JSON metadata
    int64 created_at = 20;
    int64 updated_at = 21;
}

// SignUpRequest for user registration - only authentication credentials
message SignUpRequest {
    string username = 1;
    optional string email = 2;
    optional string phone = 3;
    string password = 4;
}

// SignUpResponse after successful registration - only user data
message SignUpResponse {
    User user = 1;
    string message = 2;
    bool email_verification_required = 3;
    bool phone_verification_required = 4;
}

// VerifyEmailRequest for email verification
message VerifyEmailRequest {
    string email = 1;
    string verification_code = 2;
}

// VerifyPhoneRequest for phone verification
message VerifyPhoneRequest {
    string phone = 1;
    string verification_code = 2;
}

// VerificationResponse for verification operations
message VerificationResponse {
    bool verified = 1;
    string message = 2;
}

// ResendVerificationRequest to resend verification codes
message ResendVerificationRequest {
    string identifier = 1;  // email or phone - determined by backend
}

// ResendVerificationResponse
message ResendVerificationResponse {
    bool sent = 1;
    string message = 2;
    int64 expires_at = 3;  // When the code expires
}

// CheckUsernameRequest to check username availability
message CheckUsernameRequest {
    string username = 1;
}

// CheckUsernameResponse
message CheckUsernameResponse {
    bool available = 1;
    string message = 2;
    repeated string suggestions = 3;  // Alternative username suggestions if not available
}

// CheckEmailRequest to check email availability
message CheckEmailRequest {
    string email = 1;
}

// CheckEmailResponse
message CheckEmailResponse {
    bool available = 1;
    string message = 2;
}

// Profile Management Messages

// CreateProfileRequest to create a new profile for a user
message CreateProfileRequest {
    string user_uuid = 1;  // UUID of the user this profile belongs to
    optional string profile_name = 2;  // Name/label for this profile (e.g., "Personal", "Work", "Gaming")
    optional string first_name = 3;
    optional string last_name = 4;
    optional string display_name = 5;
    optional string bio = 6;
    optional string avatar_url = 7;
    optional int64 date_of_birth = 8;  // Unix timestamp
    optional string gender = 9;
    optional string timezone = 10;
    optional string locale = 11;
    optional string country = 12;
    optional string city = 13;
    optional string address = 14;
    optional string postal_code = 15;
    optional string website_url = 16;
    bytes metadata = 17;  // JSON metadata
}

// CreateProfileResponse
message CreateProfileResponse {
    UserProfile profile = 1;
    string message = 2;
}

// ListUserProfilesRequest to get all profiles for a user
message ListUserProfilesRequest {
    string user_uuid = 1;
    int32 limit = 2;
    int32 offset = 3;
}

// ListUserProfilesResponse
message ListUserProfilesResponse {
    repeated UserProfile profiles = 1;
    int32 total_count = 2;
    int32 limit = 3;
    int32 offset = 4;
    bool has_more = 5;
}

// UpdateProfileRequest to update a specific profile
message UpdateProfileRequest {
    string profile_uuid = 1;  // UUID of the profile to update
    optional string profile_name = 2;
    optional string first_name = 3;
    optional string last_name = 4;
    optional string display_name = 5;
    optional string bio = 6;
    optional string avatar_url = 7;
    optional int64 date_of_birth = 8;
    optional string gender = 9;
    optional string timezone = 10;
    optional string locale = 11;
    optional string country = 12;
    optional string city = 13;
    optional string address = 14;
    optional string postal_code = 15;
    optional string website_url = 16;
    bytes metadata = 17;
}

// UpdateProfileResponse
message UpdateProfileResponse {
    UserProfile profile = 1;
    string message = 2;
}

// DeleteProfileRequest to delete a specific profile
message DeleteProfileRequest {
    string profile_uuid = 1;
}

// DeleteProfileResponse
message DeleteProfileResponse {
    bool success = 1;
    string message = 2;
}

// GetUserRequest to get user by ID or username
message GetUserRequest {
    oneof identifier {
        int64 id = 1;
        string uuid = 2;
        string username = 3;
        string email = 4;
    }
    bool include_profile = 5;  // Whether to include profile information
}

// GetUserResponse
message GetUserResponse {
    User user = 1;
    optional UserProfile profile = 2;
}

// UpdateUserRequest to update user information
message UpdateUserRequest {
    string uuid = 1;
    optional string username = 2;
    optional string email = 3;
    optional string phone = 4;
    optional bool is_active = 5;
    
    // Profile updates
    optional string first_name = 6;
    optional string last_name = 7;
    optional string display_name = 8;
    optional string bio = 9;
    optional string avatar_url = 10;
    optional string timezone = 11;
    optional string locale = 12;
    optional string country = 13;
    optional string city = 14;
    optional string address = 15;
    optional string postal_code = 16;
    optional string website_url = 17;
}

// UpdateUserResponse
message UpdateUserResponse {
    User user = 1;
    UserProfile profile = 2;
}

// ChangePasswordRequest to change user password
message ChangePasswordRequest {
    string uuid = 1;
    string current_password = 2;
    string new_password = 3;
}

// ChangePasswordResponse
message ChangePasswordResponse {
    bool success = 1;
    string message = 2;
}

// ListUsersRequest for listing users with pagination and filtering
message ListUsersRequest {
    int32 limit = 1;
    int32 offset = 2;
    optional string search = 3;        // Search in username, email, first_name, last_name
    optional bool is_active = 4;       // Filter by active status
    optional bool email_verified = 5;  // Filter by email verification status
    optional bool phone_verified = 6;  // Filter by phone verification status
    optional string sort_by = 7;       // Sort by field (username, email, created_at, etc.)
    optional string sort_order = 8;    // asc or desc
}

// ListUsersResponse
message ListUsersResponse {
    repeated User users = 1;
    int32 total_count = 2;
    int32 limit = 3;
    int32 offset = 4;
    bool has_more = 5;
}

// DeleteUserRequest to delete/deactivate user
message DeleteUserRequest {
    string uuid = 1;
    bool soft_delete = 2;  // If true, just deactivate; if false, hard delete
}

// DeleteUserResponse
message DeleteUserResponse {
    bool success = 1;
    string message = 2;
}

// ===== AUTHENTICATION & SESSION MANAGEMENT =====

// SignInRequest for user authentication
message SignInRequest {
    string username = 1;                // Can be username, email, or phone - determined by backend
    string password = 2;
    optional string device_id = 3;     // Unique device identifier
    optional string device_name = 4;   // Human-readable device name
    optional string device_type = 5;   // web, mobile, desktop, tablet
    optional bool remember_me = 6;     // Extend session duration
}

// SignInResponse with authentication tokens and user data
message SignInResponse {
    string access_token = 1;
    string refresh_token = 2;
    int64 expires_at = 3;              // Access token expiration (Unix timestamp)
    int64 refresh_expires_at = 4;      // Refresh token expiration (Unix timestamp)
    User user = 5;
    UserProfile profile = 6;           // Primary profile
    string session_id = 7;             // Session UUID for tracking
    string message = 8;
}

// RefreshTokenRequest to refresh access token
message RefreshTokenRequest {
    string refresh_token = 1;
    optional string device_id = 2;
}

// RefreshTokenResponse with new tokens
message RefreshTokenResponse {
    string access_token = 1;
    string refresh_token = 2;          // New refresh token (rotation)
    int64 expires_at = 3;
    int64 refresh_expires_at = 4;
    string message = 5;
}

// LogoutRequest to end user session
message LogoutRequest {
    optional string session_id = 1;    // Specific session to logout
    optional bool all_sessions = 2;    // Logout from all devices
}

// LogoutResponse
message LogoutResponse {
    bool success = 1;
    string message = 2;
    int32 sessions_terminated = 3;     // Number of sessions ended
}

// ValidateTokenRequest to check token validity
message ValidateTokenRequest {
    string access_token = 1;
}

// ValidateTokenResponse
message ValidateTokenResponse {
    bool valid = 1;
    string message = 2;
    optional User user = 3;            // User info if token is valid
    optional int64 expires_at = 4;     // Token expiration
}

// Session information
message Session {
    string id = 1;                     // Session UUID
    string user_id = 2;                // User UUID
    string device_id = 3;
    string device_name = 4;
    string device_type = 5;
    string user_agent = 6;
    string ip_address = 7;
    string location = 8;
    bool is_active = 9;
    int64 expires_at = 10;
    int64 last_activity_at = 11;
    int64 created_at = 12;
}

// ListUserSessionsRequest to get active sessions
message ListUserSessionsRequest {
    string user_uuid = 1;
    int32 limit = 2;
    int32 offset = 3;
    optional bool active_only = 4;
}

// ListUserSessionsResponse
message ListUserSessionsResponse {
    repeated Session sessions = 1;
    int32 total_count = 2;
    int32 limit = 3;
    int32 offset = 4;
}

// TerminateSessionRequest to end specific session
message TerminateSessionRequest {
    string session_id = 1;
}

// TerminateSessionResponse
message TerminateSessionResponse {
    bool success = 1;
    string message = 2;
}
